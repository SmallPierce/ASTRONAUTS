关于数据库
=====

介绍
----
> 数据库的作用: 是为了管理和存储数据，便于程序开发。 </br>
> 常见的数据库:
>>  + oracle
>>  + db2(IBM)
>>  + mysql
>>  + sysbase
>>  + SQLserver
>>  + MongoDB(更灵活)

## 数据库体系架构

   - 逻辑结构
   - 物理结构
   - 实例
### 一 oracle 数据库的逻辑架构
<!--[数据库架构](assets/markdown-img-paste-20180311135118727.png)-->
<center><img width=50% height=50% src="assets/markdown-img-paste-20180311135118727.png"/></center>

#### 1.1 Oracle的逻辑结构
      Oracle的逻辑结构是一种层次结构，主要由：表空间，段，区，块等概念组成。逻辑结构主要是面向用户的。
<center><font color=grey>**数据库逻辑结构**</font></center>


<center><img width=50% height=50% src="assets/markdown-img-paste-20180311135346206.png"/></center>

#### 1.2 数据块  </br>

 + 数据块是Oracle的最小存储单位，oracle的数据存放在块中。一个块占用一定的磁盘空间。
>注意：</br>
> <font color="grey">1 这里的块儿是oracle数据块，不是操作系统块儿.</font></br>
> <font color="grey">2 Oracle每次请求数据，都是以块为单位，就是说，每次读取的数据都是块的整数倍，如果数据不够一块，也回按照整块的读取</font></br>
> <font color="grey">3 块的标准化大小由初始化参数DB_BLOCK_SIZE指定，块的大小和标准块的大小称为非标准块</font></br>
> <font color="grey">4 操作系统执行I/O是以操作系统块为单位，oracle数据库执行I/O是以oracle块为代表</font></br>
> <font color="grey">5 oracle数据块的大小一边是操作系统数据块的整数倍</font></br>

 + 数据块的格式
<!--![数据块格式](assets/markdown-img-paste-20180311151048293.png)-->
<center><img width="300" height="120" src="assets/markdown-img-paste-20180311151048293.png"/></center>

| 结构     | 功能                                                                                 |
| -------- | ------------------------------------------------------------------------------------ |
| 块头     | 存放块的基本信息,如：块的物理地址，块所属段的类型（数据段还是索引段）。 |
| 表目录   | 存放表的信息，如果一个表的数据被存放在这个块中，这个表的相关信息就被存放在“表目录”中。|
| 行目录   | 如果块中中有行数据存在，那么这些数据会被记录在行目录中，这些信息包括行的地址等等。|
| 自由空间 | 空余空间是一个块中未使用的区域，这片区域用于新行的插入和已经存在的行的更新。|
| 行数据   | 是真正存放表数据和索引数据的地方。这部分空间是已被数据行占用的空间。        |
> 我们把块头、表目录、行目录这三个部分称为头部信息区，头部信息区不存放数据，存放的是整个块的信息。头部的信息区是可以变的，一般来说，头部信息区的大小区介于84B到107B之间
 + 数据库自由空间的使用

| 自由区变动 | 进行的操作           |
| :-------------- |  -------------------------------------------------------------- |
| 自由空间区增加 | DELETE删除块中的记录或者UPDATE把列的值更改成一个更小的值的时候 ，释放空间的时候并不一定是连续的，oracle会在用户insert或者update数据找不到连续空间的时候，才会合并不连续的自由空间。一般来说，合并不连续空间的自由空间会影响数据库的性能|
| 自由空间区减少               | 往数据库区insert或者update数据（使记录长度增加） |

 > 一般来说，对于块中自由空间的使用，oracle一般提供两种管理方式：自动管理和手动管理。

 + 行链接

      如果我们往数据库中插入一行数据，这行数据很大，以至于数据块存不下一整行，Oracle就会把一行数据分成几行存放在几个数据块中，这个过程就叫做行链接，原理图如下
      <!--![](assets/markdown-img-paste-20180311165608704.png)-->
      <center><img width="300" height="150" src="assets/markdown-img-paste-20180311165608704.png"/></center>
 + 行迁移

      数据块中存在一条记录，用户执行UPDATE更新这条记录，这个UPDATE操作使这条记录变长，这时候，Oracle在这个数据块中进行查找，但是找不到能够容纳下这条记录的空间，无奈之下，Oracle只能把整行数据移到一个新的数据块。原来的数据块中保留一个“指针”，这个“指针”指向新的数据块。被移动的这条记录的ROWID保持不变。行迁移的原理如下图所示：
      <!--![](assets/markdown-img-paste-20180311170128484.png)-->
      <center><img width="300" height="150" src="assets/markdown-img-paste-20180311170128484.png"/></center>
  > 注:<font color="grey">无论是行链接还是行迁移，都会影响数据库的性能。Oracle在读取这样的记录的时候，Oracle会扫描多个数据块，执行更多的I/O。</font>
+ 数据块自由空间的管理

>块的自动管理：oracle使用位图来管理和跟踪数据库，这种块的空间管理方式就是我们说的自动管理，自动管理有以下的好处
> + 易于管理
> + 更好的利用空间
> + 可以对空间进行实时的管理 </br>

>数据块自由空间的主动管理：用户可以通过PCTFREE, PCTUSED来调整块中空间的使用
> + 相对于自动管理，手动管理方式比较麻烦，不容易掌握，容易造成块中空间的浪费。
> + PCTUSED用于设置一个百分比，当块中已使用的空间的比例小于这个百分比的时候，这个块才被标识为有效状态。只有有效的块才被允许插入数据。
> + PCTFREE参数用于指定块中必须保留的最小空闲空间百分例，默认值为10。之所以要预留这样的空间，是因为UPDATE时，需要这些空间。如果UPDATE时，没有空余空间，Oracle就会分配一个新的块，这会产生行迁移(Row Migrating)。

#### 1.3 数据区


#### 1.4 段

#### 1.5 表空间

###

      实例+数据库组成
      客户端向数据库发送请求
      oracle数据库管理系统，通过各种的数据，依赖我们服务器的各种服务，之后在内存中完成相关的请求响应，这样的我们叫做实例（instance） =服务+内存
      数据存放在磁盘之中
      请求提交给PGA(程序全局区)---之后提交给SGA（系统全局区---之后SGA到DB（数据库区）中去那我们要用的数据

      数据库中有两个以上的实例，我们叫做集群。集群可以提高并发访问量，提高访问的效率。
      另外的是提高我们数据库系统的安全性

      表空间和数据文件
      逻辑上讲：表空间是由多个数据文件组成，位于实例上的，这个是在我们的内存中的。我们实例真正
      操作的是表空间
      物理上讲：我们的数据文件是位于磁盘上(dbf)
              三个文件：控制文件、日志文件和数据文件

      表空间 段  区  块之间的关系
      表空间是有段组成，段是区的集合，区是数据块的集合，数据块会被映射到磁盘上
### 二 物理结构


### 三 实例

参考资料
-----
请各位遵循 [Markdown: License][license] 及其它参考文献的共享协议来使用、修改和发布。

[ORACLE体系结构](http://blog.csdn.net/sinat_33363493/article/details/51782609)
